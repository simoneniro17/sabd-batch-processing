services:
  spark-master:
    image: apache/spark:latest
    environment:
      - SPARK_MODE=master
    ports:
      - "8080:8080"  # UI Spark Master
      - "7077:7077"  # Porta per il cluster Spark
    volumes:
      - ./app:/app

  spark-worker:
    image: apache/spark:latest
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
    depends_on:
      - spark-master

  spark-client:
    image: apache/spark:latest
    depends_on:
      - spark-master
    entrypoint: ["tail", "-f", "/dev/null"]  # Tiene il container in vita
    volumes:
      - ./app:/app 

  nifi:
    image: apache/nifi:latest
    container_name: nifi
    ports:
      - "8443:8443"
    environment:
      - NIFI_WEB_HTTPS_PORT=8443
      - NIFI_WEB_HTTPS_HOST=0.0.0.0
      - SINGLE_USER_CREDENTIALS_USERNAME=admin
      - SINGLE_USER_CREDENTIALS_PASSWORD=adminpassword

networks:
  spark-network:
    driver: bridge
